name: Destroy Development

on:
  workflow_dispatch:

permissions:
  id-token: write # This is required for Az CLI Login
  contents: read # This is required for actions/checkout

concurrency: # This is required to prevent multiple runs of the same workflow from running at the same time.
  group: ${{ github.workflow }}

jobs:
  terraform-destroy-dev:
    environment: Development
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: "Az CLI Login"
      uses: azure/login@v1
      with:
        client-id: ${{ secrets.AZURE_CLIENT_ID }}
        tenant-id: ${{ secrets.AZURE_TENANT_ID }}
        subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

    #TODO: This step should delete all of the resources for the development environment
    - shell: pwsh
      run: |
        az group delete --name rg-portal-servers-integration-dev-uksouth --yes
